---
title: "cofad"
author: "Markus Burkhardt & Johannes Titz"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: rmarkdown::html_vignette
bibliography: "library.bib"
csl: apa.csl
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Citation
If you use cofad, please cite it in your work as: 

Burkhardt, M., & Titz, J. (2019). cofad: Contrast analysis for factorial designs. R package version 0.1.0. https://CRAN.R-project.org/package=cofad

## Introduction
Cofad is an R package for conducting COntrast analysis in FActorial Designs like ANOVAs. If contrast analysis was to win a price it would be the one for the most underestimated, under utilized statistical technique. This is a pitty because in every case a contrast analysis is at least as good as an ANOVA, but in most cases it is actually better. To the question why, the simplest answer is that contrast analysis gets rid off the unspecific omnibus-hypothesis *there are differences somewhere* and substitutes it with a specific hypothesis of *numerical averages for each condition*. Furthermore, contrast analysis focuses on effects instead of significance. This is expressed doubly: First, there are three different effect sizes for contrast analysis: $r_\mathrm{effectsize}$, $r_\mathrm{contrast}$ and $r_\mathrm{alerting}$. Second, the effect size refers not to the data but to the tested hypothesis. If the effect is large, this speaks for the hypothesis. One can even compare different hypotheses against each other (hello experimentum crucis) by looking at the effect size for each. 

If we sparked your interest we recommend to read some introductory literature like @Rosenthal2000 or @furr2004 (or @sedlmeier2018 for the German-speaking audience). Contrast analysis is actually really easy to understand if you know what a correlation is, which you probably do. In this vignette we assume you know some basics about contrast analysis and want to use it for your own data. We will start with between-subjects designs.

## Between-Subjects Designs
Let us first load the package:
```{r setup}
library(cofad)
```

Now we need some data and hypotheses. We can simply take the data from @furr2004, where we have different empathy ratings of students from different majors.

```{r}
d <- data.frame(empathy = c(51, 56, 61, 58, 54, 62, 67, 57, 65, 59, 50, 49, 47, 45,
                            44, 50, 45, 40, 49, 41),
                major = rep(c("psychology", "education", "business",
                              "chemistry"), each = 5))
head(d)
```

Furr states three hypotheses:

  - Contrast A: Psychology majors have higher empathy scores than Education majors ($\lambda_\mathrm{psych} = 1, \lambda_\mathrm{edu} = -1$).
  - Contrast B: Business majors have higher empathy scores than Chemistry majors ($\lambda_\mathrm{bus} = 1, \lambda_\mathrm{chem} = -1$).
  - Contrast C: On average, Psychology and Education majors have higher empathy scores than Business and Chemistry majors ($\lambda_\mathrm{psych} = 1, \lambda_\mathrm{edu} = 1, \lambda_\mathrm{bus} = -1, \lambda_\mathrm{chem} = -1$).

These hypotheses are only mean comparisons, but this is a good way to start. Let's use cofad to conduct the contrast analysis:

```{r}
ca <- calc_contrast(dv = empathy, between = major,
              lambda_between = c("psychology" = 1, "education" = -1, 
                                "business" = 0, "chemistry" = 0), data = d)
ca
```

The print method only shows some basic information, but we can use the summary method for more details:
```{r}
summary(ca)
```

From this table, $r_\mathrm{effectsize}$ is probably the most useful statistic. It is just the correlation between the lambdas and the dependent variable, which can also easily by calculated manually:

```{r}
lambdas <- rep(c(-1, 1, 0, 0), each = 5)
cor(d$empathy, lambdas)
```

The other two hypotheses can be tested accordingly:

```{r}
ca <- calc_contrast(dv = empathy, between = major,
              lambda_between = c("psychology" = 0, "education" = 0, 
                                "business" = 1, "chemistry" = -1), data = d)
ca
ca <- calc_contrast(dv = empathy, between = major,
              lambda_between = c("psychology" = 1, "education" = 1, 
                                "business" = -1, "chemistry" = -1), data = d)
ca
```

You will find that the numbers are identical to the ones presented in @furr2004. Now, imagine we have a more fun hypothesis and not just mean differences. From an elaborate theory we could derive that the means should be 73, 61, 51 and 38. We can test this with cofad directly because cofad will transfer the chosen lambdas into proper lambdas (the mean of the lambdas has to be 0):

```{r}
ca <- calc_contrast(dv = empathy, between = major,
              lambda_between = c("psychology" = 73, "education" = 51, 
                                "business" = 51, "chemistry" = 38),
              data = d)
ca
```

The manual test shows the same effect size:

```{r}
lambdas <- rep(c(73, 61, 51, 38), each = 5)
cor(d$empathy, lambdas)
```

Let us now do an analysis for within-subjects designs.

## Within-Subjects Designs

For within designs the calculations are quite different, but cofad takes care of it and we just have to use the within parameters *within* and *within_levels* instead of the between equivalents. As an example we use Table 16.5 from @sedlmeier2018. Reading ability was assessed for eight participants under four different conditions. The hypothesis is that you can read best wihout music, white noise reduces your reading ability and music (independent of type) reduces it even further.

```{r}
d <- data.frame(reading_test = c(27, 25, 30, 29, 30, 33, 31, 35,
                                 25, 26, 32, 29, 28, 30, 32, 34,
                                 21, 25, 23, 26, 27, 26, 29, 31, 
                                 23, 24, 24, 28, 24, 26, 27, 32),
                participant = as.factor(rep(1:8, 4)),
                music = rep(c("without music", "white noise", "classic", "jazz"), each = 8))
head(d)
calc_contrast(dv = reading_test, within = music,
              lambda_within = c("without music" = 1.25, 
                                "white noise" = 0.25, "classic" = -0.75, "jazz" = -0.75),
             ID = participant, data = d)
```

You can see that the siginifance test is just a t test and the reported effect size is also for a mean comparison ($g$). When conducting the analysis manually, we can see why:

```{r}
mtr <- matrix(d$reading_test, ncol = 4)
lambdas <- c(1.25, 0.25, -0.75, -0.75)
lc1 <- mtr %*% lambdas
t.test(lc1)
lambdas2 <- c(3, -1, -1, -1)
lc2 <- mtr %*% lambdas2
t.test(lc2)
```

Only the linear combination of the dependent variable and the contrast weights for each participant is needed. With these values a normal t test against 0 is conducted. While you can do this manually, using cofad is quicker and it also gives you more information such as the different effect sizes.

This was the introduction to cofad. If you have any suggestions you can post it on our gitlab site:

## References
